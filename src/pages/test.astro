---
import Layout from '../layouts/Layout.astro';
---

<Layout>
  <div class="mbti-test-card">
    <header class="mbti-header">
        <h1 class="mbti-title" id="test-title">MBTI性格特质测试</h1>
        <div class="mbti-subtitle" id="test-subtitle">国际通用版MBTI人格测试(16人格)</div>
    </header>
    <section class="mbti-question-area">
      <div class="mbti-q-top">
        <span class="mbti-q-index" id="q-index">01 / 20</span>
        <div class="mbti-progress-bar-bg">
          <div class="mbti-progress-bar" id="progress-bar"></div>
        </div>
      </div>
      <div class="mbti-q-text" id="q-text"></div>
      <div class="mbti-options">
        <div id="options-container">
          <label class="mbti-option" id="labelA">
            <input type="radio" name="mbti-option" id="optionA" value="A" />
            <span class="mbti-option-text" id="optionA-text"></span>
          </label>
          <label class="mbti-option" id="labelB">
            <input type="radio" name="mbti-option" id="optionB" value="B" />
            <span class="mbti-option-text" id="optionB-text"></span>
          </label>
        </div>
        <div id="rating-container" style="display:none; gap:8px; justify-content:center;">
          <!-- numeric 1-5 for new bank -->
          <label><input type="radio" name="rating" value="1">1</label>
          <label><input type="radio" name="rating" value="2">2</label>
          <label><input type="radio" name="rating" value="3">3</label>
          <label><input type="radio" name="rating" value="4">4</label>
          <label><input type="radio" name="rating" value="5">5</label>
        </div>
          <div class="mbti-note" id="rating-note" style="display:none;">
            <div class="mbti-note-line">1 = 非常不同意，5 = 非常同意，3 = 中立</div>
          </div>
      </div>
    </section>
    <div class="mbti-nav-row">
      <button class="mbti-btn mbti-btn-prev" id="btn-prev">&lt;&lt; 上一题</button>
      <button class="mbti-btn mbti-btn-next" id="btn-next">下一题 &gt;&gt;</button>
    </div>

  </div>
</Layout>

<script type="module" client:load>
// 原始93题库（保持不变）
// 每题A/B分别对应一个维度加分
const origQuestions = [
  { id: 1, text: "当你参加社交聚会时，你倾向于：", optionA: "与多数人交谈，包括陌生人。", optionB: "寻找熟悉的人或小团体进行深入交流。", dimensionA: "E", dimensionB: "I" },
  { id: 2, text: "你更喜欢：", optionA: "多样化和变化的生活。", optionB: "有规律和可预测的生活。", dimensionA: "N", dimensionB: "S" },
  { id: 3, text: "遇到问题时，你更依赖：", optionA: "逻辑分析。", optionB: "个人价值观和感受。", dimensionA: "T", dimensionB: "F" },
  { id: 4, text: "你做计划时：", optionA: "喜欢提前规划。", optionB: "更喜欢顺其自然。", dimensionA: "J", dimensionB: "P" },
  { id: 5, text: "你在新环境中：", optionA: "主动结识新朋友。", optionB: "等待别人来接近你。", dimensionA: "E", dimensionB: "I" },
  { id: 6, text: "你更信任：", optionA: "直觉和灵感。", optionB: "实际经验。", dimensionA: "N", dimensionB: "S" },
  { id: 7, text: "你更容易被：", optionA: "事实和数据说服。", optionB: "情感和故事打动。", dimensionA: "T", dimensionB: "F" },
  { id: 8, text: "你喜欢的工作方式：", optionA: "有明确目标和计划。", optionB: "灵活应变，随时调整。", dimensionA: "J", dimensionB: "P" },
  { id: 9, text: "你在团队中：", optionA: "喜欢带动气氛。", optionB: "更喜欢安静观察。", dimensionA: "E", dimensionB: "I" },
  { id: 10, text: "你更关注：", optionA: "未来的可能性。", optionB: "当前的现实。", dimensionA: "N", dimensionB: "S" },
  { id: 11, text: "你做决定时：", optionA: "更看重公平和原则。", optionB: "更看重人情和关系。", dimensionA: "T", dimensionB: "F" },
  { id: 12, text: "你面对突发事件时：", optionA: "喜欢有预案。", optionB: "相信自己能随机应变。", dimensionA: "J", dimensionB: "P" },
  { id: 13, text: "你更喜欢：", optionA: "热闹的聚会。", optionB: "安静的独处时光。", dimensionA: "E", dimensionB: "I" },
  { id: 14, text: "你获取信息时：", optionA: "关注整体和趋势。", optionB: "关注细节和事实。", dimensionA: "N", dimensionB: "S" },
  { id: 15, text: "你更容易：", optionA: "理性地表达观点。", optionB: "体贴地照顾他人感受。", dimensionA: "T", dimensionB: "F" },
  { id: 16, text: "你做事风格：", optionA: "喜欢按计划推进。", optionB: "喜欢灵活调整。", dimensionA: "J", dimensionB: "P" },
  { id: 17, text: "你在陌生场合：", optionA: "主动发言。", optionB: "倾向于倾听。", dimensionA: "E", dimensionB: "I" },
  { id: 18, text: "你更欣赏：", optionA: "创新和创意。", optionB: "实用和可靠。", dimensionA: "N", dimensionB: "S" },
  { id: 19, text: "你更倾向于：", optionA: "直接表达批评。", optionB: "委婉表达关切。", dimensionA: "T", dimensionB: "F" },
  { id: 20, text: "你面对任务时：", optionA: "喜欢列清单逐项完成。", optionB: "随时根据情况调整顺序。", dimensionA: "J", dimensionB: "P" },
  { id: 21, text: "计划一个旅程时，你较喜欢", optionA: "大部分的时间都是跟当天的感觉行事。", optionB: "事先知道大部分的日子会做什么。", dimensionA: "P", dimensionB: "J" },
  { id: 22, text: "在社交聚会中，你", optionA: "有时感到郁闷。", optionB: "常常乐在其中。", dimensionA: "I", dimensionB: "E" },
  { id: 23, text: "你通常", optionA: "和别人容易混熟。", optionB: "趋向自处一隅。", dimensionA: "E", dimensionB: "I" },
  { id: 24, text: "哪些人会更吸引你？", optionA: "一个思想敏捷及非常聪颖的人。", optionB: "实事求是，具丰富常识的人。", dimensionA: "N", dimensionB: "S" },
  { id: 25, text: "在日常工作中，你会", optionA: "颇为喜欢处理迫使你分秒必争的突发。", optionB: "通常预先计划，以免要在压力下工作。", dimensionA: "P", dimensionB: "J" },
  { id: 26, text: "你认为别人一般", optionA: "要花很长时间才认识你。", optionB: "用很短的时间便认识你。", dimensionA: "I", dimensionB: "E" },
  { id: 27, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "注重隐私。", optionB: "坦率开放。", dimensionA: "I", dimensionB: "E" },
  { id: 28, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "预先安排的。", optionB: "无计划的。", dimensionA: "J", dimensionB: "P" },
  { id: 29, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "抽象。", optionB: "具体。", dimensionA: "N", dimensionB: "S" },
  { id: 30, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "温柔。", optionB: "坚定。", dimensionA: "F", dimensionB: "T" },
  { id: 31, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "思考。", optionB: "感受。", dimensionA: "T", dimensionB: "F" },
  { id: 32, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "事实。", optionB: "意念。", dimensionA: "S", dimensionB: "N" },
  { id: 33, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "冲动。", optionB: "决定。", dimensionA: "P", dimensionB: "J" },
  { id: 34, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "热衷。", optionB: "文静。", dimensionA: "E", dimensionB: "I" },
  { id: 35, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "文静。", optionB: "外向。", dimensionA: "I", dimensionB: "E" },
  { id: 36, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "有系统。", optionB: "随意。", dimensionA: "J", dimensionB: "P" },
  { id: 37, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "理论。", optionB: "肯定。", dimensionA: "N", dimensionB: "S" },
  { id: 38, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "敏感。", optionB: "公正。", dimensionA: "F", dimensionB: "T" },
  { id: 39, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "令人信服。", optionB: "感人的。", dimensionA: "T", dimensionB: "F" },
  { id: 40, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "声明。", optionB: "概念。", dimensionA: "S", dimensionB: "N" },
  { id: 41, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "不受约束。", optionB: "预先安排。", dimensionA: "P", dimensionB: "J" },
  { id: 42, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "矜持。", optionB: "健谈。", dimensionA: "I", dimensionB: "E" },
  { id: 43, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "有条不紊。", optionB: "不拘小节。", dimensionA: "J", dimensionB: "P" },
  { id: 44, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "意念。", optionB: "实况。", dimensionA: "N", dimensionB: "S" },
  { id: 45, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "同情怜悯。", optionB: "远见。", dimensionA: "F", dimensionB: "N" },
  { id: 46, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "利益。", optionB: "祝福。", dimensionA: "T", dimensionB: "F" },
  { id: 47, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "务实的。", optionB: "理论的。", dimensionA: "S", dimensionB: "N" },
  { id: 48, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "朋友不多。", optionB: "朋友众多。", dimensionA: "I", dimensionB: "E" },
  { id: 49, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "有系统。", optionB: "即兴。", dimensionA: "J", dimensionB: "P" },
  { id: 50, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "富想象的。", optionB: "以事论事。", dimensionA: "N", dimensionB: "S" },
  { id: 51, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "亲切的。", optionB: "客观的。", dimensionA: "F", dimensionB: "T" },
  { id: 52, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "客观的。", optionB: "热情的。", dimensionA: "T", dimensionB: "F" },
  { id: 53, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "建造。", optionB: "发明。", dimensionA: "S", dimensionB: "N" },
  { id: 54, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "文静。", optionB: "爱合群。", dimensionA: "I", dimensionB: "E" },
  { id: 55, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "理论。", optionB: "事实。", dimensionA: "N", dimensionB: "S" },
  { id: 56, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "富同情。", optionB: "合逻辑。", dimensionA: "F", dimensionB: "T" },
  { id: 57, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "具分析力。", optionB: "多愁善感。", dimensionA: "T", dimensionB: "F" },
  { id: 58, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "合情合理。", optionB: "令人着迷。", dimensionA: "S", dimensionB: "N" },
  { id: 59, text: "当你要在一个星期内完成一个大项目，你在开始的时候会", optionA: "把要做的不同工作依次列出。", optionB: "马上动工。", dimensionA: "J", dimensionB: "P" },
  { id: 60, text: "在社交场合中，你经常会感到", optionA: "与某些人很难打开话匣儿和保持对话。", optionB: "与多数人都能从容地长谈。", dimensionA: "I", dimensionB: "E" },
  { id: 61, text: "要做许多人也做的事，你比较喜欢", optionA: "按照一般认可的方法去做。", optionB: "构想一个自己的想法。", dimensionA: "S", dimensionB: "N" },
  { id: 62, text: "你刚认识的朋友能否说出你的兴趣？", optionA: "马上可以。", optionB: "要待他们真正了解你之后才可以。", dimensionA: "E", dimensionB: "I" },
  { id: 63, text: "你通常较喜欢的科目是", optionA: "讲授概念和原则的。", optionB: "讲授事实和数据的。", dimensionA: "N", dimensionB: "S" },
  { id: 64, text: "哪个是较高的赞誉，或称许为？", optionA: "一贯感性的人。", optionB: "一贯理性的人。", dimensionA: "F", dimensionB: "T" },
  { id: 65, text: "你认为按照程序表做事", optionA: "有时是需要的，但一般来说你不大喜欢这样做。", optionB: "大多数情况下是有帮助而且是你喜欢做的。", dimensionA: "P", dimensionB: "J" },
  { id: 66, text: "和一群人在一起，你通常会选", optionA: "跟你很熟悉的个别人谈话。", optionB: "参与大伙的谈话。", dimensionA: "I", dimensionB: "E" },
  { id: 67, text: "在社交聚会上，你会", optionA: "是说话很多的一个。", optionB: "让别人多说话。", dimensionA: "E", dimensionB: "I" },
  { id: 68, text: "把周末期间要完成的事列成清单，这个主意会", optionA: "合你意。", optionB: "使你提不起劲。", dimensionA: "J", dimensionB: "P" },
  { id: 69, text: "哪个是较高的赞誉，或称许为", optionA: "能干的。", optionB: "富有同情心。", dimensionA: "T", dimensionB: "F" },
  { id: 70, text: "你通常喜欢", optionA: "事先安排你的社交约会。", optionB: "随兴之所至做事。", dimensionA: "J", dimensionB: "P" },
  { id: 71, text: "总的说来，要做一个大型作业时，你会选", optionA: "边做边想该做什么。", optionB: "首先把工作按步细分。", dimensionA: "P", dimensionB: "J" },
  { id: 72, text: "你能否滔滔不绝地与人聊天", optionA: "只限于跟你有共同兴趣的人。", optionB: "几乎跟任何人都可以。", dimensionA: "I", dimensionB: "E" },
  { id: 73, text: "你会", optionA: "跟随一些证明有效的方法。", optionB: "分析还有什么毛病，及针对尚未解决的难题。", dimensionA: "S", dimensionB: "N" },
  { id: 74, text: "为乐趣而阅读时，你会", optionA: "喜欢奇特或创新的表达方式。", optionB: "喜欢作者直话直说。", dimensionA: "N", dimensionB: "S" },
  { id: 75, text: "你宁愿替哪一类上司（或者老师）工作？", optionA: "天性淳良，但常常前后不一的。", optionB: "言词尖锐但永远合乎逻辑的。", dimensionA: "F", dimensionB: "T" },
  { id: 76, text: "你做事多数是", optionA: "按当天心情去做。", optionB: "照拟好的程序表去做。", dimensionA: "P", dimensionB: "J" },
  { id: 77, text: "你是否", optionA: "可以和任何人按需求从容地交谈。", optionB: "只是对某些人或在某种情况下才可以畅所欲言。", dimensionA: "E", dimensionB: "I" },
  { id: 78, text: "要作决定时，你认为比较重要的是", optionA: "据事实衡量。", optionB: "考虑他人的感受和意见。", dimensionA: "T", dimensionB: "F" },
  { id: 79, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "想象的。", optionB: "真实的。", dimensionA: "N", dimensionB: "S" },
  { id: 80, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "仁慈慷慨的。", optionB: "意志坚定的。", dimensionA: "F", dimensionB: "T" },
  { id: 81, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "公正的。", optionB: "有关怀心。", dimensionA: "T", dimensionB: "F" },
  { id: 82, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "制作。", optionB: "设计。", dimensionA: "S", dimensionB: "N" },
  { id: 83, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "可能性。", optionB: "必然性。", dimensionA: "N", dimensionB: "S" },
  { id: 84, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "温柔。", optionB: "力量。", dimensionA: "F", dimensionB: "T" },
  { id: 85, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "实际。", optionB: "多愁善感。", dimensionA: "T", dimensionB: "F" },
  { id: 86, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "制造。", optionB: "创造。", dimensionA: "S", dimensionB: "N" },
  { id: 87, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "新颖的。", optionB: "已知的。", dimensionA: "N", dimensionB: "S" },
  { id: 88, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "同情。", optionB: "分析。", dimensionA: "F", dimensionB: "T" },
  { id: 89, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "坚持己见。", optionB: "温柔有爱心。", dimensionA: "T", dimensionB: "F" },
  { id: 90, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "具体的。", optionB: "抽象的。", dimensionA: "S", dimensionB: "N" },
  { id: 91, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "全心投入。", optionB: "有决心的。", dimensionA: "F", dimensionB: "T" },
  { id: 92, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "能干。", optionB: "仁慈。", dimensionA: "T", dimensionB: "F" },
  { id: 93, text: "在下列每一对词语中，哪一个词语更合你心意？", optionA: "实际。", optionB: "创新。", dimensionA: "S", dimensionB: "N" },
];

// 新题库（100题），用户评分 1-5，题目顺序将随机化
const newQuestions = [
  { id: 1, text: `我通常主动与陌生人交谈。`, dimension: 'E' },
  { id: 2, text: `独处时我感到精力充沛。`, dimension: 'I' },
  { id: 3, text: `我喜欢参加大型社交聚会。`, dimension: 'E' },
  { id: 4, text: `我经常思考后再表达。`, dimension: 'I' },
  { id: 5, text: `人们认为我比较外向。`, dimension: 'E' },
  { id: 6, text: `我不喜欢成为众人瞩目的焦点。`, dimension: 'I' },
  { id: 7, text: `我很容易与刚认识的人聊起来。`, dimension: 'E' },
  { id: 8, text: `我倾向于保留自己的想法而不是说出来。`, dimension: 'I' },      
  { id: 9, text: `从社交中获得能量。`, dimension: 'E' },
  { id: 10, text: `我需要大量时间独处。`, dimension: 'I' },
  { id: 11, text: `我喜欢团队合作胜于单独工作。`, dimension: 'E' },
  { id: 12, text: `我说话比较谨慎。`, dimension: 'I' },
  { id: 13, text: `我经常主动联系朋友。`, dimension: 'E' },
  { id: 14, text: `在社交场合我会感到疲惫。`, dimension: 'I' },
  { id: 15, text: `我喜欢主持聚会或活动。`, dimension: 'E' },
  { id: 16, text: `我通常倾听多于发言。`, dimension: 'I' },
  { id: 17, text: `我擅长同时与多人交流。`, dimension: 'E' },
  { id: 18, text: `我不太愿意分享个人细节。`, dimension: 'I' },
  { id: 19, text: `我认为自己是个热情的人。`, dimension: 'E' },
  { id: 20, text: `我避免成为注意中心。`, dimension: 'I' },
  { id: 21, text: `我常常是第一个打破沉默的人。`, dimension: 'E' },
  { id: 22, text: `我宁愿用文字交流而不是当面交谈。`, dimension: 'I' },
  { id: 23, text: `我喜欢认识新朋友。`, dimension: 'E' },
  { id: 24, text: `我很难记住别人的名字。`, dimension: 'I' },
  { id: 25, text: `我在群体中经常带头讲话。`, dimension: 'E' },
  { id: 26, text: `我喜欢关注现实发生的事。`, dimension: 'S' },
  { id: 27, text: `我经常思考未来可能发生的事情。`, dimension: 'N' },
  { id: 28, text: `我对抽象概念很感兴趣。`, dimension: 'N' },
  { id: 29, text: `我更相信具体的事实而非理论。`, dimension: 'S' },
  { id: 30, text: `我经常思考事物背后的意义。`, dimension: 'N' },
  { id: 31, text: `我注重细节和精确性。`, dimension: 'S' },
  { id: 32, text: `我擅长想象新的可能性。`, dimension: 'N' },
  { id: 33, text: `我倾向于按部就班地做事。`, dimension: 'S' },
  { id: 34, text: `我喜欢探索各种想法和关联。`, dimension: 'N' },
  { id: 35, text: `我觉得讨论理论很无聊。`, dimension: 'S' },
  { id: 36, text: `我常常沉思和做白日梦。`, dimension: 'N' },
  { id: 37, text: `我更关注眼前的事而不是长远。`, dimension: 'S' },
  { id: 38, text: `我乐于思考符号和隐喻。`, dimension: 'N' },
  { id: 39, text: `我喜欢使用已知的方法解决问题。`, dimension: 'S' },
  { id: 40, text: `我容易被幻想或电影吸引。`, dimension: 'N' },
  { id: 41, text: `我宁愿实践而不是空谈理论。`, dimension: 'S' },
  { id: 42, text: `我经常预测未来的趋势。`, dimension: 'N' },
  { id: 43, text: `我偏爱具体明确的指示。`, dimension: 'S' },
  { id: 44, text: `我喜欢富有创意的工作。`, dimension: 'N' },
  { id: 45, text: `我很少关注事物的象征意义。`, dimension: 'S' },
  { id: 46, text: `我乐于设想新的系统或框架。`, dimension: 'N' },
  { id: 47, text: `我通常相信经验胜过直觉。`, dimension: 'S' },
  { id: 48, text: `我喜欢讨论哲学问题。`, dimension: 'N' },
  { id: 49, text: `我更擅长处理事实和数据。`, dimension: 'S' },
  { id: 50, text: `我相信直觉往往是对的。`, dimension: 'N' },
  { id: 51, text: `做决定时，我主要依靠逻辑分析。`, dimension: 'T' },
  { id: 52, text: `我很容易设身处地为他人着想。`, dimension: 'F' },
  { id: 53, text: `我觉得公平比同情更重要。`, dimension: 'T' },
  { id: 54, text: `我经常因别人的故事而感动。`, dimension: 'F' },
  { id: 55, text: `我更看重原则而非人情。`, dimension: 'T' },
  { id: 56, text: `我尽量避免伤害别人的感情。`, dimension: 'F' },
  { id: 57, text: `我倾向于客观地处理问题。`, dimension: 'T' },
  { id: 58, text: `我善于理解别人的情绪。`, dimension: 'F' },
  { id: 59, text: `我认为批评应当直接而诚实。`, dimension: 'T' },
  { id: 60, text: `我喜欢给人温暖的关怀。`, dimension: 'F' },
  { id: 61, text: `我通常用理性战胜感性。`, dimension: 'T' },
  { id: 62, text: `我很容易受到他人情绪影响。`, dimension: 'F' },
  { id: 63, text: `我更关注事情的对错而非感受。`, dimension: 'T' },
  { id: 64, text: `我喜欢调解人际关系冲突。`, dimension: 'F' },
  { id: 65, text: `做决策前我习惯列出利弊。`, dimension: 'T' },
  { id: 66, text: `我常常迁就他人的需求。`, dimension: 'F' },
  { id: 67, text: `我重视公正的制度。`, dimension: 'T' },
  { id: 68, text: `我倾向于宽容和体谅。`, dimension: 'F' },
  { id: 69, text: `我很少因个人感情影响判断。`, dimension: 'T' },
  { id: 70, text: `我通常优先考虑团队的和谐。`, dimension: 'F' },
  { id: 71, text: `我喜欢辩论和讨论。`, dimension: 'T' },
  { id: 72, text: `我容易被悲伤的故事打动。`, dimension: 'F' },
  { id: 73, text: `我认为诚实比委婉更重要。`, dimension: 'T' },
  { id: 74, text: `我善于抚慰他人的情绪。`, dimension: 'F' },
  { id: 75, text: `我往往基于价值观做出决定。`, dimension: 'F' },
  { id: 76, text: `我喜欢制定详细的计划。`, dimension: 'J' },
  { id: 77, text: `我乐于保持开放的选择。`, dimension: 'P' },
  { id: 78, text: `我通常会提前安排好日程。`, dimension: 'J' },
  { id: 79, text: `我倾向于随性而为。`, dimension: 'P' },
  { id: 80, text: `我喜欢事情井井有条。`, dimension: 'J' },
  { id: 81, text: `我经常拖延到最后时刻。`, dimension: 'P' },
  { id: 82, text: `我偏好结构化和确定的任务。`, dimension: 'J' },
  { id: 83, text: `我享受适应不断变化的环境。`, dimension: 'P' },
  { id: 84, text: `我会列出待办事项清单。`, dimension: 'J' },
  { id: 85, text: `我喜欢探索不同的可能性而不急于决定。`, dimension: 'P' },     
  { id: 86, text: `我通常准时完成任务。`, dimension: 'J' },
  { id: 87, text: `我经常改变主意。`, dimension: 'P' },
  { id: 88, text: `我喜欢按规则和程序行事。`, dimension: 'J' },
  { id: 89, text: `我乐于即兴发挥。`, dimension: 'P' },
  { id: 90, text: `我觉得混乱的环境让我不舒服。`, dimension: 'J' },
  { id: 91, text: `我喜欢灵活性胜过固定安排。`, dimension: 'P' },
  { id: 92, text: `我做事有条不紊。`, dimension: 'J' },
  { id: 93, text: `我容易分心难以坚持计划。`, dimension: 'P' },
  { id: 94, text: `我倾向于早早开始工作。`, dimension: 'J' },
  { id: 95, text: `我常常在最后关头才匆忙完成。`, dimension: 'P' },
  { id: 96, text: `我喜欢生活有规律。`, dimension: 'J' },
  { id: 97, text: `我更喜欢没有严格期限的任务。`, dimension: 'P' },
  { id: 98, text: `我注重承诺和守时。`, dimension: 'J' },
  { id: 99, text: `我通常同时开展多项任务但没有完成计划。`, dimension: 'P' },   
  { id: 100, text: `我会仔细记录开支和时间。`, dimension: 'J' },
];

// 状态管理
let current = 0;
// will be set after picking bank
let questions = [];
let total = 0;
let answers = [];
let isNewBank = false;

// helper to shuffle array in place
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

// 根据URL决定题库
if (typeof window !== 'undefined') {
  const params = new URLSearchParams(window.location.search);
  const bank = params.get('bank');
  if (bank === 'new') {
    isNewBank = true;
    questions = shuffle([...newQuestions]);
    // persist order so results page can recalc dimensions
    window.sessionStorage.setItem('mbti-questions', JSON.stringify(questions));
  } else {
    questions = origQuestions;
    window.sessionStorage.removeItem('mbti-questions');
  }
  total = questions.length;
  answers = Array(total).fill(null);

  // 尝试从 sessionStorage 恢复答案
  const saved = window.sessionStorage.getItem('mbti-answers');
  if (saved) {
    try { answers = JSON.parse(saved); } catch {};
  }
}

// 渲染题目
function render() {
  document.getElementById('q-index').textContent = `${String(current+1).padStart(2,'0')} / ${total}`;
  document.getElementById('q-text').textContent = questions[current].text;
  // set header text on first render
  if (current === 0) {
    if (isNewBank) {
      document.getElementById('test-title').textContent = '100题多维MBTI测评';
      document.getElementById('test-subtitle').textContent = '请用1-5分为题目评分，越符合越高分';
    } else {
      document.getElementById('test-title').textContent = 'MBTI性格特质测试';
      document.getElementById('test-subtitle').textContent = '国际通用版MBTI人格测试(16人格)';
    }
  }
  if (isNewBank) {
    // show numeric rating options
    document.getElementById('rating-container').style.display = 'flex';
    document.getElementById('options-container').style.display = 'none';
    document.getElementById('rating-note').style.display = 'block';
    // fill radio group
    const val = answers[current];
    document.querySelectorAll('input[name="rating"]').forEach(r => r.checked = (r.value === String(val)));
    // highlight selected label
    document.querySelectorAll('#rating-container label').forEach(lbl => {
      const inp = lbl.querySelector('input');
      lbl.classList.toggle('selected', inp.checked);
    });
  } else {
    document.getElementById('rating-container').style.display = 'none';
    document.getElementById('options-container').style.display = 'flex';
    document.getElementById('rating-note').style.display = 'none';
    document.getElementById('optionA-text').textContent = `A. ${questions[current].optionA}`;
    document.getElementById('optionB-text').textContent = `B. ${questions[current].optionB}`;
    document.getElementById('optionA').checked = answers[current] === 'A';
    document.getElementById('optionB').checked = answers[current] === 'B';
  }
  // 选项高亮
  if (!isNewBank) {
    document.getElementById('labelA').classList.toggle('selected', answers[current] === 'A');
    document.getElementById('labelB').classList.toggle('selected', answers[current] === 'B');
  }
  // 按钮状态
  document.getElementById('btn-prev').disabled = current === 0;
  document.getElementById('btn-prev').style.visibility = current === 0 ? 'hidden' : 'visible';
  const btnNext = document.getElementById('btn-next');
  btnNext.textContent = current === total-1 ? '查看结果' : '下一题 >>';
  // 进度条
  document.getElementById('progress-bar').style.width = `${((current+1)/total)*100}%`;
  // 选项高亮
  document.getElementById('labelA').classList.toggle('selected', answers[current] === 'A');
  document.getElementById('labelB').classList.toggle('selected', answers[current] === 'B');
}

document.getElementById('optionA').onclick = () => { answers[current] = 'A'; save(); render(); };
document.getElementById('optionB').onclick = () => { answers[current] = 'B'; save(); render(); };
// 选择方式
if (isNewBank) {
  document.querySelectorAll('input[name="rating"]').forEach(r => {
    r.onclick = () => {
      answers[current] = r.value;
      save();
      if (current < total - 1) { current++; }
      render();
    };
  });
} else {
  document.getElementById('optionA').onclick = () => {
    answers[current] = 'A';
    save();
    if (current < total - 1) { current++; }
    render();
  };
  document.getElementById('optionB').onclick = () => {
    answers[current] = 'B';
    save();
    if (current < total - 1) { current++; }
    render();
  };
}

// 上一题
document.getElementById('btn-prev').onclick = () => {
  if (current > 0) { current--; render(); }
};
// 下一题/提交
document.getElementById('btn-next').onclick = () => {
  if (!answers[current]) {
    alert('请选择一个选项或评分后再继续');
    return;
  }
  if (current < total-1) {
    current++;
    render();
  } else {
    // 计算结果
    const dim = { E:0, I:0, S:0, N:0, T:0, F:0, J:0, P:0 };
    questions.forEach((q, idx) => {
      if (isNewBank) {
        const score = parseInt(answers[idx],10);
        if (isNaN(score)) return;
        const letter = q.dimension;
        const opposite = {E:'I',I:'E',S:'N',N:'S',T:'F',F:'T',J:'P',P:'J'}[letter];
        if (score > 3) dim[letter] += score - 3;
        if (score < 3) dim[opposite] += 3 - score;
      } else {
        if (answers[idx] === 'A') dim[q.dimensionA]++;
        if (answers[idx] === 'B') dim[q.dimensionB]++;
      }
    });
    const type = `${dim.E>=dim.I?'E':'I'}${dim.S>=dim.N?'S':'N'}${dim.T>=dim.F?'T':'F'}${dim.J>=dim.P?'J':'P'}`;
    window.sessionStorage.setItem('mbti-answers', JSON.stringify(answers));
    window.location.href = `/result?type=${type}${isNewBank?'&bank=new':''}`;
  }
};

// 保存答案
function save() {
  if (typeof window !== 'undefined' && window.sessionStorage) {
    window.sessionStorage.setItem('mbti-answers', JSON.stringify(answers));
  }
}

// 初始化
render();
</script>

<style is:global>
.mbti-test-card {
  max-width: 480px;
  margin: 40px auto 24px auto;
  background: #fff;
  border-radius: 18px;
  box-shadow: 0 4px 32px rgba(74,108,247,0.10);
  padding: 32px 28px 18px 28px;
  font-family: 'Helvetica Neue', Arial, 'PingFang SC', 'Microsoft YaHei', sans-serif;
  position: relative;
}
.mbti-header {
  text-align: center;
  margin-bottom: 18px;
}
.mbti-title {
  font-size: 2.1rem;
  font-weight: 700;
  margin-bottom: 0.3rem;
  letter-spacing: 1px;
  color: #222;
}
.mbti-subtitle {
  font-size: 1.08rem;
  color: #8a8a8a;
  margin-bottom: 0.5rem;
}
.mbti-question-area {
  margin-bottom: 18px;
}
.mbti-q-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 10px;
}
.mbti-q-index {
  font-size: 1.18rem;
  font-weight: 600;
  color: #4a6cf7;
  letter-spacing: 1px;
}
.mbti-progress-bar-bg {
  flex: 1;
  height: 6px;
  background: #e7eaf3;
  border-radius: 3px;
  margin-left: 18px;
  overflow: hidden;
}
.mbti-progress-bar {
  height: 100%;
  background: linear-gradient(90deg, #4a6cf7 0%, #bc52ee 100%);
  border-radius: 3px;
  transition: width 0.3s;
}
.mbti-q-text {
  font-size: 1.13rem;
  color: #222;
  margin-bottom: 18px;
  font-weight: 500;
  min-height: 2.2em;
}
.mbti-options {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

#rating-container {
  display: flex;
  gap: 12px;
}
#rating-container label {
  cursor: pointer;
  padding: 6px 10px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 1rem;
  user-select: none;
}
#rating-container input[type="radio"] {
  display: none;
}
#rating-container label.selected {
  background: #f0f4ff;
  border-color: #4a6cf7;
  color: #4a6cf7;
  font-weight: 600;
}
.mbti-option {
  display: flex;
  align-items: center;
  font-size: 1.05rem;
  color: #333;
  cursor: pointer;
  border-radius: 8px;
  padding: 8px 10px;
  transition: background 0.18s;
  border: 1.5px solid transparent;
  user-select: none;
}
.mbti-option input[type=\"radio\"] {
  accent-color: #4a6cf7;
  margin-right: 10px;
  width: 18px;
  height: 18px;
}
.mbti-option.selected {
  background: #f0f4ff;
  border-color: #4a6cf7;
  color: #4a6cf7;
  font-weight: 600;
}
.mbti-nav-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 22px 0 10px 0;
}
.mbti-btn {
  border: none;
  border-radius: 8px;
  background: #f5f6fa;
  color: #4a6cf7;
  font-size: 1.08rem;
  font-weight: 600;
  padding: 10px 22px;
  cursor: pointer;
  transition: background 0.18s, color 0.18s;
  box-shadow: 0 2px 8px rgba(74,108,247,0.04);
}
.mbti-btn:disabled,
.mbti-btn[disabled] {
  background: #f0f0f0;
  color: #bdbdbd;
  cursor: not-allowed;
}
.mbti-btn:hover:not(:disabled) {
  background: #e7eaf3;
  color: #bc52ee;
}
.mbti-note {
  margin-top: 18px;
  text-align: center;
  color: #b0b0b0;
  font-size: 0.93rem;
  line-height: 1.6;
}
.mbti-note-line {
  margin-bottom: 2px;
}
@media (max-width: 600px) {
  .mbti-test-card {
    max-width: 99vw;
    padding: 16px 4vw 10px 4vw;
    margin: 16px auto 10px auto;
  }
  .mbti-title {
    font-size: 1.3rem;
  }
  .mbti-subtitle {
    font-size: 0.98rem;
  }
  .mbti-q-index {
    font-size: 1rem;
  }
  .mbti-q-text {
    font-size: 1rem;
  }
  .mbti-btn {
    font-size: 1rem;
    padding: 10px 0;
    width: 48vw;
    min-width: 110px;
  }
}
</style>